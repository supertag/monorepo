# ESLint & Prettier 함께 사용하기

`packages/eslint-config` workspace에서 공통으로 설정한 후 사용함  
이 패키지는 `package.json` 파일에 정의된 run script는 명령으로 한번 실행되는 것이므로 코드 점검울 위해 최종 검토용으로 사용

```sh
pnpm run lint
pnpm run format
```

코드 편집할 때 실시간 체크하려면 vscode의 `setting.json` 파일에 설정하는 것이 좋음

## vscode에서 설정 (실시간 코드 수정)

코드 편집 중 (실시간) 품질 검사(ESLint)와 코드 스타일 자동 정리(Prettier) 를 동시에 적용

(참고) eslint를 사용할 때 prettier의 설정(`.prettierrc` 파일 사용 방법  
https://heewon26.tistory.com/262

### vscode의 `setting.json`에 설정

vscode에 직접 설정해도 되고 `.vscode/setting.json` 파일에 설정해도 됨.

> 다음 설정은 vscode에서 저장이 실행될 때마다 적용됨

```jsonc
{
  "editor.tabSize": 4,
  "editor.formatOnPaste": true,
  "editor.formatOnType": true,
  "editor.formatOnSave": true,
  // "editor.defaultFormatter": "esbenp.prettier-vscode",

  //-------------------
  // Eslint 설정
  //-------------------

  // lint 검사 대상을 제한함 (css, html 등 제외)
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact",
  ],
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "always",
  },

  // 보통 이렇게 디렉토리 설정을 안해서 자동고침이 안된다
  "eslint.workingDirectories": [{ "mode": "auto" }],
}
```

## `.prettierrc` 파일에 설정

- 프로젝트 root 폴더에서 파일 생성함
- 각 하위 workspace에서도 필요하면 추가적인 설정을 덮어쓸 수 있음.
- vscode에서 `setting.json` 파일 설정보다 적용 우선순위가 더 높음

```json
{
  "arrowParens": "always",
  "bracketSameLine": false,
  "bracketSpacing": true,
  "endOfLine": "auto",
  "htmlWhitespaceSensitivity": "css",
  "jsxSingleQuote": false,
  "printWidth": 80,
  "proseWrap": "preserve",
  "quoteProps": "preserve",
  "semi": true,
  "singleQuote": true,
  "trailingComma": "es5",

  "tabWidth": 4,
  "useTabs": true,
  "overrides": [
    { "files": "*.md", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.json", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.jsonc", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.css", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.less", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.scss", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.yaml", "options": { "tabWidth": 2, "useTabs": false } }
  ]
}
```

> 위 설정은 vscode에서 저장이 실행될 때마다 적용됨  
> 위 설정은 다음 명령시에도 적용됨

> js 코드에서 주석으로 `// prettier-ignore`을 입력하면 다음 줄 구문이 prettier 문법이 적용되지 않은 상태로 출력이 됩니다.

```sh
pnpm run format
```

## `.eslint.cjs` 파일

> ESLint v9.0.0부터 기본 설정 파일이 eslint.config.js로 변경되었습니다.
> 따라서 기존의 .eslintrc.\* 파일을 eslint.config.mjs로 마이그레이션해야 합니다.

### VSCode에서 ESLint 강제 재시작

- `Ctrl + Shift + P` → `ESLint: Restart ESLint Server`
- `Ctrl + Shift + P` → `Reload Window`

pnpm dlx @eslint/migrate-config .eslintrc.json
Wrote new config to ./eslint.config.mjs

You will need to install the following packages to use the new config:

- @eslint/js
- @eslint/eslintrc
  pnpm install @eslint/js @eslint/eslintrc

=====================================

루트 폴더의 `.eslint.js` 확장자를 `.cjs`로 바꾸어도 아무 상관 없음

- ESLint 설정 파일은 `.eslintrc.js, .eslintrc.cjs, .eslintrc.json, .eslintrc.yaml` 등 다양한 확장자를 가질 수 있습니다.
- .eslintrc.js 파일은 CommonJS 모듈 시스템을 사용하여 설정을 내보냅니다.
- `.cjs` 파일은 CommonJS 모듈 시스템을 명시적으로 사용합니다. 이는 ES 모듈(`.mjs`)과 구분하기 위해 사용됩니다.

`eslint-config` workspace의`index.js` 파일 (설정) 내용을 공유함  
파일에 몇가지 규칙을 추가해 봄.

```jsonc
// 추가
{
  "plugins": ["@typescript-eslint", "prettier"],
  "rules": {
    "@typescript-eslint/no-non-null-assertion": "off",
    "prettier/prettier": "error",
    // var 변수 선언 금지 (let 또는 const를 사용)
    "no-unused-vars": "warn",
    // console 객체의 사용을 제한
    // 'no-console': 'warn',
    // ==와 != 연산자를 사용 금지 (===와 !==를 사용)
    "eqeqeq": "warn",
  },
}
```

`ui` workspace의`.eslint.cjs` 파일 내용 중 다음 부분은 수정이 필요함

```js
  parserOptions: { project: true, }
  // 다음으로 수정
  parserOptions: { project: './tsconfig.json', }
```

- 값을 생략하면 TypeScript ESLint 파서(`@typescript-eslint/parser`)가 TypeScript 프로젝트의 설정 파일(`tsconfig.json`)을 참조하지 않게 됩니다
- TypeScript 프로젝트에서 정확한 타입 검사를 위해 값을 설정하는 것이 중요합니다.
- 만약 생략하면, ESLint는 기본적인 JavaScript 구문 검사만 수행하게 됩니다.

> 설정 파일 작성 후 적용이 안된것 같으면 vscode를 재 구동 시켜볼것.

다시 동작 확인해봄

```sh
pnpm run lint
pnpm run format
```

## 실행 구문

prettier, ESLint 실행 예시

```sh
# 수정할 내용이 있는지만 체크
pnpm prettier --check .
# 수정할 내용이 있으면 파일 수정
pnpm prettier --write .

# 경로 설정
pnpm eslint "src/**/*.{js,ts,tsx}" --fix
pnpm prettier --write "src/**/*.{js,ts,tsx}"

# 모노레포 전체에서 실행
pnpm eslint . --fix
pnpm prettier --write .

# Turborepo 사용 시 병렬 실행 가능
pnpm turbo run lint --parallel
pnpm turbo run format --parallel

# 특정 패키지에서만 실행
pnpm eslint apps/web --fix
pnpm prettier --write apps/web
```
