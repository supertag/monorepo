# ESLint & Prettier 함께 사용하기

`packages/eslint-config` workspace에서 공통으로 설정한 후 사용함  
이 패키지는 `package.json` 파일에 정의된 run script는 명령으로 한번 실행되는 것이므로 코드 점검울 위해 최종 검토용으로 사용

```sh
pnpm run lint
pnpm run format
```

코드 편집할 때 실시간 체크하려면 vscode의 `setting.json` 파일에 설정하는 것이 좋음

## vscode에서 설정 (실시간 코드 수정)

코드 편집 중 (실시간) 품질 검사(ESLint)와 코드 스타일 자동 정리(Prettier) 를 동시에 적용

(참고) eslint를 사용할 때 prettier의 설정(`.prettierrc` 파일 사용 방법  
https://heewon26.tistory.com/262

### vscode의 `setting.json`에 설정

vscode에 직접 설정해도 되고 `.vscode/setting.json` 파일에 설정해도 됨.

> 다음 설정은 vscode에서 저장이 실행될 때마다 적용됨

```jsonc
{
  "editor.tabSize": 4,
  "editor.formatOnPaste": true,
  "editor.formatOnType": true,
  "editor.formatOnSave": true,
  // "editor.defaultFormatter": "esbenp.prettier-vscode",

  //-------------------
  // Eslint 설정
  //-------------------

  // lint 검사 대상을 제한함 (css, html 등 제외)
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact",
  ],
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "always",
  },

  // 보통 이렇게 디렉토리 설정을 안해서 자동고침이 안된다
  "eslint.workingDirectories": [{ "mode": "auto" }],
}
```

## `.prettierrc` 파일에 설정

- 프로젝트 root 폴더에서 파일 생성함
- 각 하위 workspace에서도 필요하면 추가적인 설정을 덮어쓸 수 있음.
- vscode에서 `setting.json` 파일 설정보다 적용 우선순위가 더 높음

```json
{
  "arrowParens": "always",
  "bracketSameLine": false,
  "bracketSpacing": true,
  "endOfLine": "auto",
  "htmlWhitespaceSensitivity": "css",
  "jsxSingleQuote": false,
  "printWidth": 80,
  "proseWrap": "preserve",
  "quoteProps": "preserve",
  "semi": true,
  "singleQuote": true,
  "trailingComma": "es5",

  "tabWidth": 4,
  "useTabs": true,
  "overrides": [
    { "files": "*.md", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.json", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.jsonc", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.css", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.less", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.scss", "options": { "tabWidth": 2, "useTabs": false } },
    { "files": "*.yaml", "options": { "tabWidth": 2, "useTabs": false } }
  ]
}
```

> 위 설정은 vscode에서 저장이 실행될 때마다 적용됨  
> 위 설정은 다음 명령시에도 적용됨

> js 코드에서 주석으로 `// prettier-ignore`을 입력하면 다음 줄 구문이 prettier 문법이 적용되지 않은 상태로 출력이 됩니다.

```sh
pnpm run format
```

## `.eslint.cjs` 파일

> ESLint v9.0.0부터 기본 설정 파일이 eslint.config.js로 변경되었습니다.
> 따라서 기존의 .eslintrc.\* 파일을 eslint.config.mjs로 마이그레이션해야 합니다.

### VSCode에서 ESLint 강제 재시작

- `Ctrl + Shift + P` → `ESLint: Restart ESLint Server`
- `Ctrl + Shift + P` → `Reload Window`
- `Ctrl` + `Shift` + `P` → `ESLint: Fix all auto-fixable problems`

```sh
# 패키지 추가 설치
pnpm add @eslint/js @eslint/eslintrc
```

루트 폴더의 `.eslint.js` 확장자를 `.mjs`로 바꾸어도 아무 상관 없음  
`eslint-config` workspace의`index.mjs` 파일 (설정) 내용을 공유함

`ui` workspace의`.eslint.mjs` 파일 내용 수정이 필요함

```js
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import config from '@repo/eslint-config';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

export default [
  ...config,
  {
    languageOptions: {
      parserOptions: {
        project: './tsconfig.json',
        tsconfigRootDir: __dirname,
      },
    },
  },
];
```

나머지 다른 workspace의`.eslint.mjs` 파일 내용 수정

```js
import config from '@repo/eslint-config';
// 루트에서는 상대 경로 사용
// import config from './packages/eslint-config/index.mjs';
export default [...config];
```

> 설정 파일 작성 후 적용이 안된것 같으면 vscode를 재 구동 시켜볼것.

다시 동작 확인해봄

```sh
pnpm run lint
pnpm run format
```

## 실행 구문

prettier, ESLint 실행 예시

```sh
# 수정할 내용이 있는지만 체크
pnpm prettier --check .
# 수정할 내용이 있으면 파일 수정
pnpm prettier --write .

# 경로 설정
pnpm eslint "src/**/*.{js,ts,tsx}" --fix
pnpm prettier --write "src/**/*.{js,ts,tsx}"

# 모노레포 전체에서 실행
pnpm eslint . --fix
pnpm prettier --write .

# Turborepo 사용 시 병렬 실행 가능
pnpm turbo run lint --parallel
pnpm turbo run format --parallel

# 특정 패키지에서만 실행
pnpm eslint apps/web --fix
pnpm prettier --write apps/web
```

# Prettier 제한적으로 사용

다음 두 기능이 맘에 들지 않아 저장할때 prettier 확장 도구 기능 사용 안함

- 삼항 연산 구문에서 괄호가 사라짐
- 여러 빈줄이 하나로 합쳐짐

`setting.json` 파일을 수정하여 js 코드에서 저장할때 prettier 확장도구가 실행되지 않도록 함.

- 대신 단축키로 prettier 기능은 명시적으로 사용함.
- Eslint 확장도구를 설치하여 저장시마다 (eslint --fix) 적용함

```jsonc
{
  "editor.formatOnPaste": false,
  "editor.formatOnType": false,
  "editor.formatOnSave": false,
  "[markdown]": { "editor.formatOnSave": true },
  "[json]": { "editor.formatOnSave": true },
  "[jsonc]": { "editor.formatOnSave": true },

  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "always",
  },
}
```

## Prettier, Eslint 직접 실행

마찬가지로 pnpm 명령에서도 js 코드에는 사용하지 않음

- `.prettierignore` 파일 목록에 추가하면 vscode에서 단축키로 포맷을 실행하는 경우에도 제외 파일 목록이 적용되므로
- pnpm 호출 명령에서 대상 파일을 수정해줌

```jsonc
// js(x) 관련 파일들은 prettier 사용 안함
{
  "scripts": {
    "format": "prettier --write . \"!**/*.{ts,tsx,js,jsx,*js}\"",
  },
}
```

```jsonc
// apps\web\package.json
// 대신 esLint에서 fix 옵션을 줌
{
  "scripts": {
    "lint": "eslint \"src/**/*.{ts,tsx,js,jsx,*js}\" --fix",
  },
}
```

prettier 확장 기능은 vscode의 열린 파일에서 명시적으로 호춣해서 사용함

```jsonc
// setting.json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
}
```

- 파일 전체 포맷: `Shift` + `Alt` + `F`
- 선택 영역 포맷: `Ctrl` + `K` & `Ctrl` + `F`

## rules 추가, 수정

prittier의 기능을 lint에서 지원해 주기 위해 fix 가능한 rules를 추가해줌

```sh
# js, jsx, ts, tsx 모든 규칙을 제공
pnpm i -D @stylistic/eslint-plugin
```

`packages/eslint-config/index.mjs` 파일에서 rules를 추가

- `@eslint/js`: https://eslint.org/docs/latest/rules/
- `@typescript-eslint`: https://typescript-eslint.io/rules/
- `@stylistic/eslint-plugin`: https://eslint.style/packages/default

`packages/eslint-config/index.mjs` 파일에서 rules를 수정하면 ESLint Server를 재시작 해줘야 함

- `Ctrl + Shift + P` → `ESLint: Restart ESLint Server`
- `Ctrl` + `Shift` + `P` → `ESLint: Fix all auto-fixable problems`

```sh
pnpm install @html-eslint/parser @html-eslint/eslint-plugin
```
