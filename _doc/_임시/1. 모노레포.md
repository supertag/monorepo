# 개발 환경 설정

## NodeJS (npm) 설치 확인

Node.js가 설치되어 있는지 확인합니다. Node.js가 설치되어 있지 않다면
[Node.js 공식 웹사이트](vscode-file://vscode-app/c:/Users/pdi10/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html)에
서 설치하세요.

```sh
npm --version
```

### pmpm + turborepo 설치

```sh
# mkdir my-monorepo && cd my-monorepo
npm install -g pnpm
# pnpm init                 # package.json 파일이 생성됨.

pnpm dlx create-turbo@latest --example with-vite-react monorepo
pnpm dlx create-turbo@latest --example with-vite-react monorepo
pnpm dlx create-turbo@latest -e with-vite-react monorepo
# packageManager를 pnpm을 선택한 후 진행
```

### package Json 파일 생성 (`package.json`)

```json
{
  "private": true,
  "script": {
    "dev": "turbo run dev --parallel",
    "build": "turbo run build",
    "lint": "turbo run lint",
    "test": "turbo run test"
  }
}
```

Monorepo에서는 `package.json`에 `private: true`를 설정하는 것이 필수입니다.

- 루트 패키지가 독립적인 패키지로 배포되지 않도록 방지
- pnpm, npm, yarn의 Workspace 기능을 사용하려면 필수

만약 private: true를 설정하지 않으면?

- pnpm install 실행 시 Monorepo의 구조가 깨질 수 있음
- pnpm이 개별 패키지를 제대로 관리하지 못하고, 루트 패키지를 npm에 실수로 배포할 가능성이 있음

# Monorepo 프로젝트 생성

pnpm + Turborepo 조합으로 구성합니다.

### 다음 폴더 구조로 생성

```perl
my-monorepo/
│── apps/                 # 실제 실행되는 애플리케이션
│   ├── web/              # React 프론트엔드 (React + Vite)
│   ├── api/              # 백엔드 API (NodeJS + Express + vite-plugin-ssr)
│
│── packages/             # 공유되는 패키지
│   ├── types/            # Typescript 타입 공유 패키지
│   ├── ui/               # 공통 UI 라이브러리
│   ├── utils/            # 유틸리티 함수 모음
│
│── package.json          # 최상위 패키지 매니저 설정
│── pnpm-workspace.yaml   # pnpm 워크스페이스 설정
│── turbo.json            # Turborepo 설정 파일

```

### pnpm 워크스페이스 설정 (`pnpm-workspace.yaml`)

```yml
packages:
  - 'apps/*'
  - 'packages/*'
```

이렇게 하면 apps/와 packages/ 내의 모든 폴더가 워크스페이스로 설정됨.  
pnpm에서는 `pnpm-workspace.yaml`을 사용하여 workspace를 정의해야 합니다.

### Turborepo 설정 (`turbo.json`)

```sh
pnpm add -D -w turbo
pnpm dlx turbo init       # .turbo 폴더가 생성됨.
```

```json
{
  // Turborepo의 기본 구성 파일을 상속
  // build, dev, lint 등의 파이프라인을 자동으로 설정
  "extends": "turbo",

  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "dev": {
      "cache": false
    },

    "lint": {},
    "test": {}
  }
}
```

#### 원격측정 해지

(Vercel Inc.) Turborepo 사용에 대한 원격 측정 데이터를 수집 해지

```sh
turbo telemetry disable
# turbo telemetry status
# turbo telemetry enable
```

또는 환경변수로 설정

```js
TURBO_TELEMETRY_DISABLED = 1;
DO_NOT_TRACK = 1;
```

## 실행

최상위 폴더에서 실행한다.

```sh
pnpm turbo run dev
# turbo run dev

# 하나의 workspace만 실행하기 (ex. docs)
pnpm turbo dev --filter docs

# 웹 및 서버 동시에 실행
pnpm turbo run dev --parallel

# 모든 앱 빌드
pnpm turbo run build
```

- apps/web → http://localhost:3000에서 React 앱 실행 예정
- apps/api → http://localhost:5000에서 Express 서버 실행 예정

서버를 구동시킬 수 있도록 하위 패키지를 구성해 보자
